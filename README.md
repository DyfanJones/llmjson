# llmjson

<!-- badges: start -->
<!-- badges: end -->

`llmjson` is a thin R wrapper around the Rust crate [llm_json](https://github.com/oramasearch/llm_json) for repairing malformed JSON strings, particularly those generated by Large Language Models (LLMs).

## Features

- Repairs missing quotes around keys and values
- Handles trailing commas
- Fixes unquoted keys
- Repairs incomplete arrays and objects
- Converts single quotes to double quotes
- Removes extra non-JSON characters
- Auto-completes missing values with sensible defaults

## Installation

You can install the development version of llmjson from GitHub:

``` r
# install.packages("devtools")
devtools::install_github("DyfanJones/llmjson")
```

### System Requirements

This package requires the Rust toolchain to be installed on your system. If you don't have Rust installed:

- Install from <https://www.rust-lang.org/tools/install>
- Minimum required version: Rust 1.65.0

## Usage

### Repair JSON Strings

``` r
library(llmjson)

# Repair JSON with trailing comma
repair_json_str('{"key": "value",}')
#> [1] "{\"key\":\"value\"}"

# Repair JSON with unquoted keys
repair_json_str('{key: "value"}')
#> [1] "{\"key\":\"value\"}"

# Repair incomplete JSON
repair_json_str('{"name": "John", "age": 30')
#> [1] "{\"name\":\"John\",\"age\":30}"

# Repair JSON with single quotes
repair_json_str("{'name': 'John'}")
#> [1] "{\"name\":\"John\"}"
```

### Repair JSON from Files

``` r
# Read and repair JSON from a file
repair_json_file("malformed.json")
```

### Repair JSON from Raw Bytes

``` r
# Repair JSON from raw byte vector
raw_data <- charToRaw('{"key": "value",}')
repair_json_raw(raw_data)
#> [1] "{\"key\":\"value\"}"
```

## Use Case: Working with LLM Outputs

Large Language Models often generate JSON that is almost correct but has minor syntax errors. This package helps you handle those cases gracefully:

``` r
# LLM might output JSON with trailing commas and unquoted keys
llm_output <- '{
  users: [
    {name: "Alice", age: 30,},
    {name: "Bob", age: 25,},
  ],
}'

repaired <- repair_json_str(llm_output)
parsed <- jsonlite::fromJSON(repaired)
print(parsed)
#>        name age
#> 1    Alice  30
#> 2      Bob  25
```

## Available Functions

- **`repair_json_str(json_str)`** - Repair a malformed JSON string
- **`repair_json_file(path)`** - Read and repair JSON from a file
- **`repair_json_raw(raw_bytes)`** - Repair JSON from a raw byte vector

## Comparison with Similar Packages

While R has several JSON parsing packages like `jsonlite`, they typically fail when encountering malformed JSON. `llmjson` is specifically designed to handle the common errors that LLMs make when generating JSON output, making it ideal for:

- Processing LLM API responses
- Parsing structured data from AI-generated text
- Building robust data pipelines with LLM integrations
- Working with JSON data from web scraping or unreliable sources

## Acknowledgments

This package is a thin wrapper around the [llm_json](https://github.com/oramasearch/llm_json) Rust crate, which is itself a Rust port of the Python [json_repair](https://github.com/mangiucugna/json_repair) library by mangiucugna.
